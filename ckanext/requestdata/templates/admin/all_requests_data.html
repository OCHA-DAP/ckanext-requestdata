{% extends "admin/base.html" %}

{% import 'macros/form.html' as form %}

{% block primary_content_inner %}
  {% set service_url = h.url_for('download_requests_data') %}
  {% set csv = '?format=csv'%}
  {% set json = '?format=json'%}
  <div class="dropdown">
    <button class="btn btn-primary dropdown-toggle " type="button" data-toggle="dropdown">Download
    <span class="caret"></span></button>
    <ul class="dropdown-menu dropdown-menu-left">
      <li><a href="{{ service_url }}{{ csv }}">CSV</a></li>
      <li><a href="{{ service_url }}{{ json }}">JSON</a></li>
    </ul>
  </div>
  <div class="sysadmin-requests-container">
    {% for org in organizations %}
      <h2 data-id="{{ org.id }}">Organization: {{ org['title'] }}</h2>
      {% snippet 'requestdata/snippets/filter_requests.html', org_name=org.name, title='Maintainer', filter_options=org.maintainers, type='maintainer' %}

      {% snippet 'requestdata/snippets/section_base.html', state='new', title='New', requests=org['requests_new'] %}
      {% snippet 'requestdata/snippets/section_base.html', state='open', title='Open', requests=org['requests_open'] %}

            {% set service_url = h.url_for('ckanadmin_requests_data') %}
            {% set o = org['name']%}
            {% set asc = "?order_by=asc|org:"+ o%}
            {% set desc = '?order_by=desc|org:' + o%}
            {% set req = '?order_by=requests|org:' + o %}
            {% set shared = '?order_by=shared|org:' + o %}
          <div class="dropdown">
            <button class="btn btn-primary dropdown-toggle " type="button" data-toggle="dropdown">ORDER BY
            <span class="caret"></span></button>
            <ul class="dropdown-menu dropdown-menu-left">
              <li><a href="{{ service_url }}{{ asc }}">ALPHABETICAL(A-Z)</a></li>
              <li><a href="{{ service_url }}{{ desc }}">ALPHABETICAL (Z-A)</a></li>
               <li><a href="{{ service_url }}{{ req }}">REQUESTS RATE</a></li>
               <li><a href="{{ service_url }}{{ shared }}">SHARING RATE</a></li>
            </ul>
          </div>
      {% snippet 'requestdata/snippets/section_base.html', state='archive', title='Archive', requests=org['requests_archive'] %}
    {% endfor %}
  </div>
  <div class="alert alert-dismissible request-message-alert hide" role="alert">
    <div class="alert-text"></div>
  </div>
{% endblock %}

{% block secondary_content %}
  <div class="module module-narrow module-shallow">
    <h2 class="module-heading">
      <i class="icon-info-sign"></i>
      {{ _('Data') }}
    </h2>
    <div class="module-content">
      {% block admin_form_help %}
        <p><strong>Requested data:</strong> We will add info for these page here</a>.</p>
      {% endblock %}
    </div>
  </div>
{% endblock %}
